<div class='row-fluid separator' id='project-heading'>
  <div class='span12'>
    <p class='heading-title'><%= model.get('project_title').toLowerCase().toTitleCase() %></p>
    <div class='col col-700' id='project-descr'>
      <p class='heading-desc'><%= model.get('project_descr') %></p>
    </div>
  </div>
</div>

<div class='col col-540 col-mar-10 projects summary'>
  <div id='top-stats' class='row-fluid'>

    <div class='span5'>
      <div class='row-fluid'>
        <div class='span12'>
          <div class='label visible-phone'>Location</div>
          <div id='profilemap' class='map'></div>
          <!-- Country at a Glance -->
          <div class='row-fluid country-profile'>
            <div class='span12 inner'>
              <h3><%= model.get('operating_unit') %> at a glance</h3>
              <div id='country-summary'></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Project Progress Bar -->
    <div class='span7'>
      <div class='row-fluid'>
        <div class='span12 dates'>
          <div class='label'>Project Timeline
              <a data-toggle='modal' class='about-data pull-right' href='#about-data'>
                  <i class='icon-exclamation-sign icon-dark'></i> About the data
              </a>
          </div>
          <div class='dates-label'>
            <span class='start'><%= start %></span>
            <span class='end'><%= end %></span>
          </div>
          <div id='progress' class='progress'>
            <div class='bar'></div>
          </div>
        </div>
      </div>
      <div class='row-fluid stat'>
        <div class='span12'>
          <% _.each(model.get('budgetyears'), function(v,k) { %>
            <div class='label'><%= k %> Budget</div>
            <div><%= accounting.formatMoney(v) %></div>
          <% }); %>
        </div>
      </div>
      <div class='row-fluid stat'>
        <div class='span12'>
          <% _.each(model.get('expendyears'), function(v,k) { %>
            <div class='label'><%= k %> Expenditure</div>
            <div><%= accounting.formatMoney(v) %></div>
          <% }); %>
        </div>
      </div>
      <% if (model.get('inst_descr')) { %>
      <div class='row-fluid stat'>
        <div class='span12'>
          <div class='label'>Implementing Organization</div>
          <p><%= model.get('inst_descr') %></p>
        </div>
      </div>
      <% } %>
      <div class='row-fluid stat'>
        <div class='span12'>
          <div class='label'>Budget Sources</div>
          <%
            var donors_id = _.chain(model.get('outputs'))
                .map(function (o) { return o.donor_id })
                .flatten()
                .union()
                .value();
            var donors_short = _.chain(model.get('outputs'))
                .map(function (o) { return o.donor_short })
                .flatten()
                .union()
                .value();
            var donors_long = _.chain(model.get('outputs'))
                .map(function (o) { return o.donor_name })
                .flatten()
                .union()
                .value();
            %>
          <p>
            <% if (donors_long.length < 5) {
              _.each(donors_id, function(o,i) { %>
            <a href='#filter/donors-<%= o %>'><%= donors_long[i] %></a><% if (i != donors_id.length -1) { %>, <% } %>
            <% });
              } else {
                  _.each(donors_id, function(o,i) { %>
            <a href='#filter/donors-<%= o %>'><%= donors_short[i] %></a><% if (i != donors_id.length -1) { %>, <% } %>
            <% });
              } %>
          </p>
        </div>
      </div>
      <% if (!_.isEmpty(documents)) { %>
      <div class='row-fluid'>
        <div class='span12'>
          <div class='label'>Documents</div>
          <div id='documents' class='row-fluid'>
            <div class='span12'>
              <ul class='unstyled'>
                <% _.each(documents, function(d) { %>
                <li><a href='<%= d.src %>'>
                  <span class='icon filetype filetype-<%= d.filetype %>'></span>
                  <%= d.title %></a>
                </li>
                <% }); %>
              </ul>
            </div>
          </div>
          <!--/ #documents -->
        </div>
      </div>
      <% } %>
    </div>
  </div>

  <!--/ #top-stats -->
  <% if (model.get('outputs')) { %>
    <div class='separator' id='output-header'>
      <p class='heading-title'>
        <% if (model.get('outputs').length > 1) { %>
        <span><%= model.get('outputs').length %></span>
        <% } %>
        <% if (model.get('outputs').length === 1) { %>Output<% } else { %>Outputs<% } %>
      </p>
    </div>
    <div id='outputs'></div>
    <div class='load'>
      <a href='#' class='button'>Load More</a>
    </div>
  <% } %>
</div>
<!--/ #summary -->

<div id='content-right' class='col col-240 col-end hidden-phone'>

  <div id='flickr' class='row-fluid'>
    <div class='spin'></div>
    <img class='fade' src='' alt='' />
    <div class='resize' title='Resize'>
      <div class='icon fullscreen'></div>
      <span class='text'>Details</span>
    </div>
    <div class='control prev' title='Previous'>
      <div class='icon back'></div>
    </div>
    <div class='control next' title='Next'>
      <div class='icon forward'></div>
    </div>
    <!-- Captions -->
    <div class='meta'></div>
  </div>
  <div id='twitter-block' class='inner'>
    <div class='row-fluid'>
      <div class='span12'>
        <div class='tweet fade'></div>
        <div id='twitter'></div>
      </div>
    </div>
  </div>
  <a href='#widget' class='widget-config' data-toggle='modal'>Embed<span class='icon embed'></span></a>
</div>
<!--/ #content-right -->

<!-- Modals -->
<div class='modal hide fade' id='unit-contact'>
  <div class='modal-header'>
    <button type='button' class='close' data-dismiss='modal'>&times;</button>
    <h3>UNDP <%= model.get('operating_unit') %> on the Web</h3>
  </div>
  <div class='modal-body'>
  </div>
</div>
<div class='modal hide fade' id='about-data'>
  <div class='modal-header'>
    <button type='button' class='close' data-dismiss='modal'>&times;</button>
    <h3>About the data</h3>
  </div>
  <div class='modal-body'><p>Projects shown with end dates in the past are operationally-closed projects that were financially closed in the previous fiscal year. Any transactions shown are accounting entries made to facilitate this change or to reconcile accounts.</p><p>Some projects show negative numbers for expenditures. In these instances, the projects are likely being managed at a different level or are undergoing accounting reconciliation. For instance, in some cases financial management is at the Fund level (such as for Trust Funds) rather than the Project level so adjustments made within a Fund can lead to negative expenditures being displayed.</p>
  </div>
</div>

